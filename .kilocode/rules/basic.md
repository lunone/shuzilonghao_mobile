# basic.md

## 项目技术栈约束

本项目是基于uni-app的转译型微信小程序，受以下技术栈约束：
- uni-app
- Vue 2/3
- 微信小程序运行环境
- Vite
- iconfont
- Less
- Pinia

## 移动端开发规范

在UI布局与事件响应方面需完全遵循**移动端特性**：

### CSS/样式约束
- 避免使用通配符选择器 `*`
- 避免使用`position: fixed`在小程序中的异常表现
- 使用rpx替代px进行响应式布局
- 注意微信小程序中flex布局的兼容性差异

### API使用限制
- 禁止使用微信小程序不支持的H5 API（如`document`、`window`、`localStorage`等）
- 使用uni-app API替代原生DOM操作
- 网络请求统一使用request模块

### 资源管理
- 微信小程序不支持直接引用本地图片资源
- 图片需上传至CDN或使用Base64编码
- 字体图标统一使用iconfont，避免使用本地字体文件

### 其他平台限制
- 页面栈深度限制（最多10层）
- 单个页面包大小限制
- 组件生命周期差异

## 数据交互规范

### 请求流程
```
组件 → (Store缓存，可选) → API模块 → request.ts → 后端服务
```

### request.ts 核心功能
1. **统一请求入口**：所有HTTP请求必须通过此文件
2. **自动数据解包**：自动处理后端返回的包装结构（如`{data: 值, code: 200}`）
3. **身份认证**：内置静默登录和token自动刷新机制
4. **错误处理**：统一错误拦截和用户提示
5. **请求拦截**：自动添加认证头、参数序列化
6. **响应拦截**：统一处理HTTP状态码和业务错误码

### 使用约定
- 组件中直接使用解包后的数据，无需再次处理`data`字段
- 禁止在组件、store、api中编写重复的try-catch逻辑
- 错误处理由request统一管理，特殊情况需在组件中处理时需明确注释原因

## 目录结构说明

### 特殊目录用途
- `/other` - 临时文件、计划文档、交接资料
- `/design` - 设计图、UI稿、产品文档
- `/think` - AI思考过程记录（自动生成）



## 开发指导原则

### 开发流程
1. **禁止随意运行构建命令**：除非明确指令，否则不运行`npm run dev/build`
2. **热更新优先**：充分利用Vite热更新进行开发调试
3. **错误透明化**：不掩盖错误，优先修复而非隐藏

### 图标使用规范
1. **优先级**：
   - 优先使用`src/styles/icon.less`中定义的图标
   - 其次使用项目已集成的第三方图标库
   - 最后考虑使用emoji或新增iconfont
2. **添加新图标**：如需添加新图标，需同步更新icon.less文件

### 时间日期处理
1. **统一使用dayjs**：所有时间操作使用dayjs库
2. **与后端交互**：
   - 传递Date类型数据给后端
   - 接收后端时间戳或ISO字符串，使用dayjs转换
3. **格式化约定**：
   - 显示格式：`YYYY-MM-DD HH:mm:ss`
   - 存储格式：ISO 8601或时间戳

### 代码质量
1. **TypeScript优先**：使用TypeScript编写，确保类型安全
2. **组件拆分**：复杂组件按功能拆分，保持单一职责
3. **注释规范**：公共组件、复杂逻辑需添加清晰注释
4. **性能优化**：
   - 避免不必要的重渲染
   - 合理使用组件懒加载
   - 图片资源按需加载

## AI协作规范

### 思考过程记录
1. **自动记录**：每次AI回复需在`/think`目录下生成记录文件
2. **文件命名**：`YYYY-MM-DD_HH-mm-ss.md`（按时间戳）
3. **记录内容**：
   - 用户指令原文
   - AI的思考分析过程
   - 最终决策和实现方案
   - 注意事项和边界条件

### 记录文件模板
```markdown
# 思考记录 - [时间]

## 用户指令
[用户原始指令内容]

## 问题分析
1. [核心需求分析]
2. [技术约束考量]
3. [潜在问题识别]

## 解决方案
1. [实现方案]
2. [技术选型理由]
3. [替代方案比较]

## 实施细节
- [具体实现步骤]
- [关键代码逻辑]
- [注意事项]

## 总结反思
- [方案优缺点]
- [可能的风险]
- [后续优化建议]
```

### AI工作原则
1. **需求澄清**：对模糊需求主动询问确认
2. **约束遵守**：严格遵守项目技术栈限制
3. **方案比较**：提供多个可行方案并说明优劣
4. **渐进实现**：复杂功能分阶段实现
5. **安全提醒**：识别潜在安全问题并提醒

## 版本与维护

### 变更记录
所有对基础规则的修改需：
1. 更新本文件
2. 在`/other/changelog.md`中记录变更
3. 通知相关开发人员

### 紧急例外处理
如遇特殊情况需违反上述规范：
1. 必须在代码中添加详细注释说明原因
2. 在`/other/exceptions.md`中记录
3. 后续需回归整改

---